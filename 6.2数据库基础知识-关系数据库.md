# 6.2 数据库基础知识-关系数据库

# 1. 关系数据库基础概念

![关系数据库基础概念](source/image/6.2-01.png)

## 1.1 关系的基本术语

        - 属性（Atribute）
        描述一个事物尝尝取若干特征来表示。这些特征称为属性。
        - 域（Domain）
        每个属性的取值范围对应一个值的集合，称为该属性的域。所有的域都应是原子数据。
        - 目或度（Degree）
        指一个关系中属性的个数。
        - 候选码（Candidate Key）
        若关系中的某一属性或属性组的只能唯一的标识一个元组称改属性或属性组未候选码。
        - 主码（Primary Key）
        或称主键，若一个关系有多个候选码，则选定一个作为主码。
        - 主属性（Primary Attribute）
        包含在任何候选码中的属性称为主属性。不包含在任何候选码中的属性称为非主属性。
        - 外码（Foreign Key）
        如果关系中的一个属性是另一个关系的主码，则称该属性为外码。也称为外键。

![外码](source/image/6.2-02.png)

        - 全码（Super Key）
        一个关系中所有属性的集合称为全码。

## 1.2 关系的模型

       关系模式是一个五元组，包括关系名、属性名、域、主码、外码。
       表示为：R(U,D,DOM,F) 
       - R为关系名
       - U为属性名
       - D为域
       - DOM为属性的取值范围
       - F为外码,属性间的数据依赖关系集合
       记为：R(A1,A2,...,An) R 关系名，A1,A2,...,An为属性名


## 1.3 关系的完整性约束

        （1）实体的完整性(entity integrity)
        关系中的主键不能重复，不能取空值。
        如主键字是多个属性的组合，则所有主属性均不得取空值。

![实体的完整性](source/image/6.2-03.png)

        （2）参照完整性（referential integrity）
        是指建立关系之间联系的主键与外键引用的约束条件。就是不允许引用不存在的主体。

![参照完整性](source/image/6.2-04.png)      

        （3）用户自定义完整性（user defined intefrity）
        根据应用环境的要求和实际的需要，对某一具体应用所涉及的数据的完整性约束条件。

![用户自定义完整性](source/image/6.2-05.png)   

# 2. 常用的关系操作

## 2.1 基本操作

        - 查询：选择、投影、连接、除、并、交、差
        - 更新：插入、删除、修改
        查询的表达能力是其中最主要的部分
        - 传统的集合运算是二目运算，包括并、交、差、广义笛卡尔积
        - 专门的关系运算包括：选择、投影、连接、除

![基本操作](source/image/6.2-06.png)

        1. 并

![并](source/image/6.2-07.png)

        2. 差

![差](source/image/6.2-08.png)

        3. 交

![交](source/image/6.2-09.png)

        4. 笛卡尔积

![笛卡尔积](source/image/6.2-10.png)

# 3. 关系运算

        关系运算：选择、投影、连接、除和外连接

        在关系代数中，关系运算是对关系的操作，其结果仍然是关系。

![关系运算](source/image/6.2-11.png)

## 3.1 投影

        投影操作从关系R中选取若干属性组成新的关系，该操作对关系进行垂直分割，消去某些列，并重新安排列的顺序，再删去重复的元组。
        注意：投影之后不仅取消了原关系中的某些列，而且还可能取消某哦写元组（避免重复行）。

![投影](source/image/6.2-12.png) 


![投影](source/image/6.2-13.png) 

## 3.2 选择

        选择操作从关系R中选取满足某一条件的元组组成新的关系，该操作对关系进行水平分割，消去某些行。

![选择](source/image/6.2-14.png)

![选择](source/image/6.2-15.png)

## 3.3 连接

        连接分为Θ连接、等值连接及自然连接。
        连接运算是指从两个关系R和S的笛卡尔积中选取属性间满足一定条件的元组。
        
![连接](source/image/6.2-16.png)

        1) Θ连接，表示连接条件，可以是等号、不等号、大于、小于、大于等于、小于等于等。

![连接](source/image/6.2-17.png)
![连接](source/image/6.2-18.png)

        2) 等值连接，是指连接条件是等号的连接。

![连接](source/image/6.2-19.png)
![连接](source/image/6.2-20.png)

        3) 自然连接，是指连接条件是等号的连接，且连接的属性只出现一次。

![连接](source/image/6.2-21.png)
![连接](source/image/6.2-22.png)


## 3.4. 外连接

![连接](source/image/6.2-23.png)
![连接](source/image/6.2-24.png)


## 3.5 左外连接

![连接](source/image/6.2-26.png)

## 3.6 右外连接
        
![连接](source/image/6.2-25.png)

## 3.7 除法

![连接](source/image/6.2-27.png)
![连接](source/image/6.2-28.png)

# 4. 函数依赖

        定义：设R(U)是一个关系模式，X和Y是R(U)的属性集合，若对于R(U)的任意一个可能的关系r，对于r中的任意两个元组t1和t2，若t1[X]=t2[X]，则必有t1[Y]=t2[Y]，则称X函数决定Y，记为X->Y。

![函数依赖](source/image/6.2-29.png)

## 4.1 部分函数依赖

        设R(U)是一个关系模式，X和Y是R(U)的属性集合，X'是X的子集，若X->Y且X'->Y不成立，Y部分依赖于X，则称X->Y是部分函数依赖。

![部分函数依赖](source/image/6.2-30.png)

## 4.2 完全函数依赖

        设R(U)是属性集U上的关系，X、Y是U的子集，X’是X的真子集，若X->Y成立，而对于X’->Y不成立，则称X->Y是完全函数依赖。

![完全函数依赖](source/image/6.2-31.png)

## 4.3 传递函数依赖

        在关系模式中R(U)，X、Y、Z是U的子集，若X->Y，Y->Z，而X->Z不成立，则称Z是传递函数依赖X。

![传递函数依赖](source/image/6.2-32.png)

# 5. 规范化理论

![规范化理论](source/image/6.2-33.png)
![规范化理论](source/image/6.2-34.png)

# 6. 范式

## 6.1 第一范式（1NF）

        第一范式是指关系模式R(U)的每一个属性都是不可分解的基本数据项，即属性不可再分。
        不满足第一范式，就不是关系型数据库。

![第一范式](source/image/6.2-35.png)

## 6.2 第二范式（2NF）

        第二范式是指关系模式R(U)必须满足第一范式，且R(U)中的每一个非主属性完全函数依赖于R(U)的某个候选码。
        简单的说，是表中的属性必须完全依赖于全部主键，而不是部分主键。所以只有一个主键的表如果符合第一范式，那一定是第二范式。
        
![第二范式](source/image/6.2-36.png)

## 6.3 第三范式（3NF）

        第三范式是指关系模式R(U)必须满足第二范式，且R(U)中的每一个非主属性不传递依赖于函数依R(U)的任何一个候选码。
        简单的说，就是表中的非主属性不能依赖于其他非主属性。所以只有一个主键的表如果符合第二范式，那一定是第三范式。

![第三范式](source/image/6.2-37.png)

## 6.4 BCNF范式

        BCNF范式是指关系模式R(U)必须满足第一范式，且R(U)中的每一个属性都完全函数依赖于R(U)的每一个候选码。
        简单的说，就是表中的每一个属性都不能依赖于其他属性。所以只有一个主键的表如果符合第三范式，那一定是BCNF范式。

![BCNF范式](source/image/6.2-38.png)

> 例题
![例题](source/image/6.2-39.png)

